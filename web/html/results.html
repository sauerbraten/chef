<!doctype html>

<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta charset="utf-8">

	<title>{{.Query}} – CHEF</title>

	<link href="/style.css" rel="stylesheet">
</head>

<body>

	<header>
		<h1 class="align-center">
			<a class="subtle" href="/">CHEF</a>
		</h1>
	</header>

	<main>
		<form class="searchform text-center" action="/lookup" method="get">
			<input type="search" name="q" class="searchbox" placeholder="name or IP (range)" autofocus />
			<br />
			<label for="sorting">sort by</label>
			<select name="sorting">
				<option value="name_frequency" {{if .SortedByNameFrequency}}selected{{end}}>name frequency</option>
				<option value="last_seen" {{if not .SortedByNameFrequency}}selected{{end}}>last seen</option>
			</select>
			<br />
			<input type="checkbox" name="direct" value="true" {{if .PerformedDirectLookup}}checked{{end}} />
			<label for="direct">force direct lookup</label>
			<br />
			<input type="submit" value="Search" />
		</form>

		<header>
			<h2>Results for {{.Query}}</h2>
			<small>interpreted as {{if .InterpretedAsName}}name{{else}}IP range{{end}} | performed {{if .PerformedDirectLookup}}direct lookup{{else}}2-step lookup{{end}} | sorted by {{if .SortedByNameFrequency}}name frequency{{else}}last seen{{end}}</small>
		</header>

		{{if len .Results}}
		<table>
			<thead>
				<tr>
					<td class="align-center">Player IP</td>
					<td class="align-center">Player Name</td>
					<td class="align-center">Last Seen</td>
					<td class="align-center">Server IP</td>
					<td class="align-center">Port</td>
					<td>Server Description</td>
				</tr>
			</thead>
			<tbody>
				{{range .Results}}
				<tr>
					<td class="align-right{{if ipIsInKidbannedNetwork .IP}} orange{{end}}">
						{{if ne .IP "0.0.0.0"}}
							<a class="subtle" target="_blank" href="https://stat.ripe.net/{{.IP}#tabId=at-a-glance">{{.IP}}</a>
						{{else}}
							{{.IP}}
						{{end}}
					</td>
					<td>{{.Name}}</td>
					<td class="align-center">{{timestring .Timestamp}}</td>
					<td class="align-right">
						<a class="subtle" target="_blank" href="http://bgp.he.net/ip/{{.ServerIP}}">{{.ServerIP}}</a>
					</td>
					<td class="align-right">{{.ServerPort}}</td>
					<td>{{.ServerDescription}}</td>
				</tr>
				{{end}}
			</tbody>
		</table>
		{{else}}
		<p>
			Nothing found!
		</p>
		{{end}}
	</main>

	<footer>
		<small>
			Sauerbraten spy by pix – <a href="/status">Status</a> – <a href="/info">More Information</a>
		</small>
	</footer>

</body>
</html>
